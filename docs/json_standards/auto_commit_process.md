# Auto Commit Package Process Documentation

## Introduction

The `auto_commit.py` module automates the process of committing and pushing code changes to the Git repository while linking each commit to specific project tasks. This automation enables precise tracking of project progress by associating commits with tasks and updating progress metrics accordingly.

This document provides a comprehensive overview of the inputs, processing steps, and outputs of the `auto_commit` package, including how input JSON files should be constructed, the internal processing workflow, and the generated output JSON files.

---

## Inputs

The `auto_commit` package relies on several input sources, primarily JSON files and Git repository status:

### 1. Git Changes

- The module fetches the current Git status using `git status --short` to identify changed files.
- Changes include added, modified, deleted, renamed, and untracked files.
- These changes serve as the primary input for determining what files to commit.

### 2. Linked WBS Resources JSON

- File: `project_inputs/PM_JSON/intermediate/linked_wbs_resources.json`
- This JSON file contains the Work Breakdown Structure (WBS) tasks linked with resource allocations and dependencies.
- It is used to map changed files to specific tasks, retrieve task metadata such as dependencies, deadlines, and allocations.
- **Construction:** This file is generated by parsing and linking user-defined WBS input files and resource allocation files. It should be kept up-to-date to ensure accurate task mapping.

### 3. Workflow Definition JSON

- File: `workflow_definition.json`
- Defines the workflow stages and their associated weights.
- Used to calculate progress increments, importance, and urgency based on the current workflow stage of tasks.
- **Construction:** Created and maintained by project managers to reflect the project lifecycle stages.

---

## Processing

The `auto_commit.py` module performs the following processing steps:

### 1. Synchronize Local Repository

- Pulls the latest changes from the remote `origin/main` branch using `git pull --ff-only` to ensure the local branch is up-to-date.

### 2. Detect and Group Changes

- Retrieves the list of changed files from Git.
- Groups files by their top-level directory to reflect code relationships and task grouping.

### 3. Categorize Files

- Categorizes files within each group by change type: Added, Modified, Deleted, Renamed, Untracked, etc.

### 4. Commit and Push Changes

- For each file in each category and group:
  - Stages the file using `git add`.
  - Generates a professional conventional commit message based on the file category and group.
  - Commits the file with the generated message.
  - Pushes the commit to the remote repository.

### 5. Calculate Progress, Importance, and Urgency

- Maps each group to a workflow stage.
- Calculates progress change per commit based on workflow stage weights and total commits in the stage.
- Retrieves task metadata from the linked WBS resources JSON.
- Calculates task importance based on criticality, dependencies, progress, and delays.
- Calculates task urgency based on deadlines, delays, and progress.

### 6. Update Commit-Task Database

- Updates the `commit_task_database.json` file with detailed metadata for each commit, including:
  - Task ID, file path, commit message, workflow stage
  - Progress change, importance change, priority (urgency) change
  - Commit timestamp, author, email, branch, and parent commits

### 7. Update Commit Progress JSON

- Generates and writes a simplified progress mapping to `commit_progress.json` reflecting overall progress per group.

---

## Outputs

The `auto_commit` package generates and updates the following JSON files:

### 1. commit_task_database.json

- Location: `project_management/PM_SystemOutputs/system_outputs/commit_task_database.json`
- Contains detailed mappings of commit hashes to tasks with metadata.
- Used for audit trails, progress tracking, and reporting.
- Automatically updated by the `auto_commit.py` module during commit operations.

### 2. commit_progress.json

- Location: `project_management/PM_SystemOutputs/system_outputs/commit_progress.json`
- Contains simplified progress ratios per group based on committed files.
- Used by progress calculators and reporting modules to monitor project progress.
- Automatically generated by the `auto_commit.py` module after commits.

---

## Integration and Usage

- The `auto_commit.py` module integrates tightly with the project's Git repository and JSON-based project management system.
- It relies on accurate and up-to-date input JSON files to map commits to tasks correctly.
- Commit messages must follow the project's conventional commit style to ensure proper task association.
- The module supports workflow-driven progress tracking by linking commits to workflow stages and calculating weighted progress increments.

---

## References

For detailed JSON file standards and additional context, please refer to:

- [commit_task_database.json Standard](./commit_task_database.md)
- [JSON Files Overview](./json_files_overview.md)
- [Workflow Definition Standard](./workflow_definition_detailed.md)

---

## Summary

This document provides a complete overview of the `auto_commit` package process, detailing its inputs, internal processing, and outputs. Proper use and maintenance of the input JSON files and adherence to commit standards ensure accurate project progress tracking and management through automated commit handling.
